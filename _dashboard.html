<div class="parent-dashboard-modern">
    <!-- Welcome Header with Child Spotlight -->
    <div class="welcome-banner">
        <div class="welcome-content">
            <div class="welcome-greeting">
                <h1>Hello, {{ current_user.name }}! ðŸ‘‹</h1>
                <p class="welcome-subtitle">Let's see how {{ selected_child.name }} is growing today</p>
            </div>
        </div>
    </div>

    <!-- Child Spotlight Card -->
    <div class="child-spotlight-card">
        <div class="spotlight-left">
            <div class="child-avatar-modern">
                <div class="avatar-circle">
                    <i class="bi bi-person-circle"></i>
                </div>
                <div class="avatar-decoration"></div>
            </div>
        </div>
        <div class="spotlight-right">
            <h2 class="child-name-modern">{{ selected_child.name }}</h2>
            <div class="child-meta">
                <span class="meta-item meta-age">
                    <i class="bi bi-cake2-fill"></i>
                    {{ selected_child.age }} years
                </span>
                <span class="meta-item meta-grade">
                    <i class="bi bi-book-fill"></i>
                    Grade {{ selected_child.grade_level }}
                </span>
                <span class="meta-item meta-gender">
                    <i class="bi bi-{{ 'gender-male' if selected_child.gender|lower == 'male' else 'gender-female' }}"></i>
                    {{ selected_child.gender }}
                </span>
            </div>
        </div>
    </div>


      <!-- Academic Progress Chart - Full Width -->

    <div class="chart-card-modern-full academic-progress-beautiful">
        <div class="chart-header-gradient">
            <div class="header-icon-wrapper">
                <i class="bi bi-graph-up-arrow"></i>
            </div>
            <div class="header-text">
                <h3>Academic Progress Summary</h3>
                <p class="header-subtitle">Track your child's learning journey</p>
            </div>
        </div>
        <div class="chart-body-enhanced">
            {% if subjects %}
                <div class="chart-wrapper">
                    <canvas id="academicChart"></canvas>
                </div>
                <div class="chart-stats-row">
                    <div class="stat-badge">
                        <i class="bi bi-trophy-fill"></i>
                        <span class="stat-value">{{ subjects|length }}</span>
                        <span class="stat-label">Subjects</span>
                    </div>
                    <div class="stat-badge">
                        <i class="bi bi-clipboard-check-fill"></i>
                        <span class="stat-value">{{ scores|length }}</span>
                        <span class="stat-label">Total Records</span>
                    </div>
                </div>
            {% else %}
                <div class="empty-state-beautiful">
                    <div class="empty-state-icon">
                        <i class="bi bi-clipboard-data"></i>
                    </div>
                    <h4>No Academic Data Yet</h4>
                    <p>Start tracking your child's academic progress today!</p>
                    <a href="{{ url_for('academic_progress') }}" class="btn-modern-beautiful">
                        <i class="bi bi-plus-circle-fill"></i>
                        Add First Score
                    </a>
                </div>
            {% endif %}
        </div>
    </div>


    <!-- Smart Insights Section -->
    <div class="section-header-modern">
        <h3><i class="bi bi-magic"></i> Smart Insights</h3>
        <p>AI-powered recommendations for your child</p>
    </div>

    <div class="insights-modern-grid">
        <!-- Preschool Performance -->
        <div class="insight-card-modern insight-card-teal">
            <div class="insight-header">
                <i class="bi bi-balloon-heart-fill"></i>
                <h4>Preschool Progress</h4>
            </div>
            <div class="insight-content">
                {% for p in preschool %}
                    {{ p|safe }}
                {% else %}
                    <div class="insight-empty">
                        <i class="bi bi-info-circle"></i>
                        <p>Add preschool data to see insights</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Learning Style -->
        <div class="insight-card-modern insight-card-amber">
            <div class="insight-header">
                <i class="bi bi-emoji-smile-fill"></i>
                <h4>Learning Style</h4>
            </div>
            <div class="insight-content">
                {% for l in learning %}
                    {{ l|safe }}
                {% else %}
                    <div class="insight-empty">
                        <i class="bi bi-info-circle"></i>
                        <p>Add observations to discover learning style</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Recommendations -->
        <div class="insight-card-modern insight-card-blue">
            <div class="insight-header">
                <i class="bi bi-star-fill"></i>
                <h4>Recommendations</h4>
            </div>
            <div class="insight-content">
                {% for t in tutoring %}
                    {{ t|safe }}
                {% else %}
                    <div class="insight-empty">
                        <i class="bi bi-info-circle"></i>
                        <p>Complete assessments for personalized tips</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const academicCtx = document.getElementById('academicChart');
  if (academicCtx) {
    const subjects = {{ subjects|tojson }};
    const allScores = {{ scores|tojson }};

    // Calculate average for each subject
    const averages = subjects.map(subject => {
      const subjectScores = allScores.filter(r => r.subject === subject).map(r => r.score);
      if (subjectScores.length > 0) {
        return Math.round((subjectScores.reduce((a, b) => a + b, 0) / subjectScores.length) * 100) / 100;
      }
      return 0;
    });

    new Chart(academicCtx, {
      type: 'bar',
      data: {
        labels: subjects,
        datasets: [{
          label: 'Average Score',
          data: averages,
          backgroundColor: [
            'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
            'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
            'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
            'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
            'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
            'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
          ].map((gradient, i) => {
            const canvas = academicCtx;
            const ctx = canvas.getContext('2d');
            const colors = [
              { start: '#667eea', end: '#764ba2' },
              { start: '#f093fb', end: '#f5576c' },
              { start: '#4facfe', end: '#00f2fe' },
              { start: '#43e97b', end: '#38f9d7' },
              { start: '#fa709a', end: '#fee140' },
              { start: '#30cfd0', end: '#330867' },
              { start: '#a8edea', end: '#fed6e3' }
            ];
            const gradientFill = ctx.createLinearGradient(0, 0, 0, 400);
            gradientFill.addColorStop(0, colors[i % colors.length].start);
            gradientFill.addColorStop(1, colors[i % colors.length].end);
            return gradientFill;
          }),
          borderColor: [
            '#667eea',
            '#f093fb',
            '#4facfe',
            '#43e97b',
            '#fa709a',
            '#30cfd0',
            '#a8edea'
          ],
          borderWidth: 3,
          borderRadius: 12,
          borderSkipped: false,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleColor: '#fff',
            bodyColor: '#fff',
            padding: 12,
            borderColor: 'rgba(255, 255, 255, 0.2)',
            borderWidth: 1,
            cornerRadius: 8,
            displayColors: true,
            callbacks: {
              label: function(context) {
                return 'Average: ' + context.parsed.y + '%';
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            grid: {
              color: 'rgba(0, 0, 0, 0.05)',
              drawBorder: false
            },
            ticks: {
              color: '#64748b',
              font: {
                size: 12,
                weight: '500'
              },
              callback: function(value) {
                return value + '%';
              }
            },
            title: {
              display: true,
              text: 'Average Score',
              color: '#475569',
              font: {
                size: 14,
                weight: '600'
              }
            }
          },
          x: {
            grid: {
              display: false,
              drawBorder: false
            },
            ticks: {
              color: '#64748b',
              font: {
                size: 12,
                weight: '600'
              }
            },
            title: {
              display: true,
              text: 'Subjects',
              color: '#475569',
              font: {
                size: 14,
                weight: '600'
              }
            }
          }
        },
        animation: {
          duration: 1500,
          easing: 'easeInOutQuart'
        }
      }
    });
  }
});
</script>