{% extends "base.html" %}
{% block content %}
<div class="container-fluid vh-100">
  <div class="row h-100">

    <!-- Left: image (only shown on md+) -->
    <div class="col-md-8 d-none d-md-block p-0">
      <div class="h-100 w-100 register-bg">
      </div>
    </div>

    <!-- Right: form -->
    <div class="col-12 col-md-4 d-flex align-items-center justify-content-center">
      <div class="auth-box w-90 w-md-75">
        <h3 class="text-center mb-3" style="color: #0e88b4;">Create an Account</h3>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, msg in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ msg }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <form method="POST" novalidate>
          <div class="mb-3">
            <input type="text" class="form-control" name="name" placeholder="Name" required>
          </div>
          <div class="mb-3">
            <input type="email" class="form-control" name="email" placeholder="Email" required>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" name="password" placeholder="Password" required>
          </div>
          <div class="mb-3">
            <select class="form-select" name="role" required>
              <option value="">Select Role</option>
              <option value="parent">Parent</option>
              <option value="admin">Admin</option>
            </select>
          </div>

            <div class="mb-3 d-none" id="admin-passkey-group">
            <input type="password" class="form-control" name="admin_passkey" placeholder="Admin Passkey">
            <small class="text-muted">Enter the admin passkey provided to you.</small>
          </div>

          <button type="submit" class="btn btn-primary w-100">Sign up</button>
        </form>

        <div class="text-center mt-3">
          <small style="color: #0e88b4;">Already have an account? <a href="{{ url_for('login') }}" class="auth-link">Back to Login</a></small>
        </div>
      </div>
    </div>

  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const roleSelect = document.querySelector("select[name='role']");
    const passkeyGroup = document.getElementById('admin-passkey-group');

    function toggleAdminPasskeyVisibility() {
      if (!roleSelect || !passkeyGroup) return;
      const isAdmin = roleSelect.value === 'admin';
      passkeyGroup.classList.toggle('d-none', !isAdmin);

      const passkeyInput = passkeyGroup.querySelector("input[name='admin_passkey']");
      if (passkeyInput) {
        passkeyInput.required = isAdmin;
        if (!isAdmin) passkeyInput.value = '';
      }
    }

    toggleAdminPasskeyVisibility();
    roleSelect?.addEventListener('change', toggleAdminPasskeyVisibility);
  });
</script>

{% endblock %}
