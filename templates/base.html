<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ title or "ChildGrowth Insights" }}</title>

  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
    rel="stylesheet">

  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

   {% if request.endpoint not in ['login', 'register', 'register_select', 'register_parent', 'register_admin', 'reset_password', 'forgot'] %}
    <!-- Navbar (hidden on login page) -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-gradient">
      <div class="container">
        <a class="navbar-brand fw-bold d-flex align-items-center" href="{{ url_for('select_child') }}">
          <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" 
            style="height: 40px; width: auto; margin-right: 10px;">
          ChildGrowth Insights
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" 
                data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" 
                aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <span class="nav-link">Hi, {{ current_user.name }}</span>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('profile') }}" title="Profile">
                <i class="fa-solid fa-user-circle"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('logout') }}" title="Logout">
                <i class="fa-solid fa-right-from-bracket"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  {% endif %}

  {% block content %}{% endblock %}

  {% set _flashes = get_flashed_messages(with_categories=true) %}
  {% if _flashes %}
    <script>
    document.addEventListener("DOMContentLoaded", function () {
      const flashes = {{ _flashes|tojson }};

      flashes.forEach(item => {
        const category = item[0];
        const message = item[1];

        let icon = 'info';
        if (category === 'success') icon = 'success';
        else if (category === 'danger' || category === 'error') icon = 'error';
        else if (category === 'warning') icon = 'warning';

        Swal.fire({
          icon: icon,
          title: category.charAt(0).toUpperCase() + category.slice(1),
          text: message,
          confirmButtonColor: "#3085d6"
        });
      });
    });
    </script>
  {% endif %}

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          const form = btn.closest("form");
          Swal.fire({
            title: "Are you sure?",
            text: "This will permanently delete the child profile.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#d33",
            cancelButtonColor: "#3085d6",
            confirmButtonText: "Yes, delete it!"
          }).then((result) => {
            if (result.isConfirmed) form.submit();
          });
        });
      });
    });
  </script>
</body>
</html>
