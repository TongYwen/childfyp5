<h3>Dashboard</h3>

<!-- Top Card: Child Info -->
<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <h5 class="card-title">{{ selected_child.name }}</h5>
    <p><strong>Age:</strong> {{ selected_child.age }}</p>
    <p><strong>Grade Level:</strong> {{ selected_child.grade_level }}</p>
    <p><strong>Gender:</strong> {{ selected_child.gender }}</p>
  </div>
</div>

<!-- 4-Card Grid -->
<div class="row g-4">
  <!-- Academic Progress (bar chart) -->
  <div class="col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title">Academic Progress Summary</h5>
        <canvas id="academicChart" style="min-height: 300px;"></canvas>
      </div>
    </div>
  </div>

  <!-- Preschool Performance Tracker -->
  <div class="col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title">Preschool Performance Tracker</h5>
        <ul>
          {% for p in preschool %}
            {{ p|safe }}
          {% else %}
            <li class="text-muted">No benchmark comparisons yet</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <!-- Learning Style Analyzer -->
  <div class="col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title">Learning Style Analyzer</h5>
        <ul>
          {% for l in learning %}
            {{ l|safe }}
          {% else %}
            <li class="text-muted">No observations yet</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <!-- Tutoring Recommendations -->
  <div class="col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title"> Recommendations</h5>
        <ul>
          {% for t in tutoring %}
            {{ t|safe }}
          {% else %}
            <li class="text-muted">No recommendations yet</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const academicCtx = document.getElementById('academicChart');
  if (!academicCtx) return;

  const subjects = {{ subjects|tojson }};
  const allScores = {{ scores|tojson }};

  // Calculate average for each subject
  const averages = subjects.map(subject => {
    const subjectScores = allScores
      .filter(r => r.subject === subject)
      .map(r => r.score);

    if (subjectScores.length > 0) {
      return Math.round(
        (subjectScores.reduce((a, b) => a + b, 0) / subjectScores.length) * 100
      ) / 100;
    }
    return 0;
  });

  new Chart(academicCtx, {
    type: 'bar',
    data: {
      labels: subjects,
      datasets: [{
        label: 'Average Score',
        data: averages,
        backgroundColor: [
          'rgba(255, 99, 132, 0.7)',
          'rgba(54, 162, 235, 0.7)',
          'rgba(255, 206, 86, 0.7)',
          'rgba(75, 192, 192, 0.7)',
          'rgba(153, 102, 255, 0.7)',
          'rgba(255, 159, 64, 0.7)',
          'rgba(99, 255, 132, 0.7)'
        ],
        borderColor: [
          'rgba(255, 99, 132, 1)',
          'rgba(54, 162, 235, 1)',
          'rgba(255, 206, 86, 1)',
          'rgba(75, 192, 192, 1)',
          'rgba(153, 102, 255, 1)',
          'rgba(255, 159, 64, 1)',
          'rgba(99, 255, 132, 1)'
        ],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          title: {
            display: true,
            text: 'Average Score'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Subject'
          }
        }
      }
    }
  });
});
</script>
